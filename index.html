<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Mart - Online Grocery Store</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }
    
    /* Header Styles */
    header {
      background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
      color: white;
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo i {
      font-size: 28px;
    }
    
    .logo h1 {
      font-size: 24px;
    }
    
    .cart-icon {
      position: relative;
      font-size: 24px;
      cursor: pointer;
    }
    
    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: #ff5722;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    
    /* Hero Section */
    .hero {
      background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1498837167922-ddd27525d352?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80') no-repeat center center/cover;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }
    
    .hero-content h2 {
      font-size: 2.5rem;
      margin-bottom: 15px;
    }
    
    /* Products Section */
    .products-section {
      padding: 40px 0;
    }
    
    .section-title {
      text-align: center;
      margin-bottom: 30px;
      color: #388e3c;
      font-size: 28px;
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
    }
    
    .product-card {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
    }
    
    .product-image {
      height: 180px;
      overflow: hidden;
    }
    
    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .product-card:hover .product-image img {
      transform: scale(1.05);
    }
    
    .product-info {
      padding: 15px;
    }
    
    .product-name {
      font-size: 18px;
      margin-bottom: 8px;
      color: #333;
    }
    
    .product-price {
      color: #388e3c;
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 15px;
    }
    
    .quantity-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    
    .qty-btn {
      background: #f1f1f1;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-weight: bold;
    }
    
    .qty-input {
      width: 50px;
      text-align: center;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 5px;
    }
    
    .add-to-cart {
      background: #388e3c;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      width: 100%;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    
    .add-to-cart:hover {
      background: #2e7d32;
    }
    
    /* Cart Section */
    .cart-section {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin: 40px 0;
      display: none;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
    }
    
    .cart-item-info {
      flex: 1;
    }
    
    .cart-item-name {
      font-weight: bold;
    }
    
    .cart-item-price {
      color: #388e3c;
    }
    
    .cart-item-quantity {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .remove-item {
      color: #f44336;
      cursor: pointer;
      background: none;
      border: none;
      font-size: 18px;
    }
    
    .cart-total {
      text-align: right;
      font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid #eee;
    }
    
    .checkout-btn {
      background: #ff5722;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s ease;
    }
    
    .checkout-btn:hover {
      background: #e64a19;
    }
    
    /* Checkout Form */
    .checkout-form {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin: 40px 0;
      display: none;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    
    .form-control {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    
    .submit-order {
      background: #388e3c;
      color: white;
      border: none;
      padding: 15px 25px;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      width: 100%;
      transition: background 0.3s ease;
    }
    
    .submit-order:hover {
      background: #2e7d32;
    }
    
    /* Order Success */
    .order-success {
      text-align: center;
      padding: 40px 0;
      display: none;
    }
    
    .success-icon {
      color: #388e3c;
      font-size: 60px;
      margin-bottom: 20px;
    }
    
    /* Footer */
    footer {
      background: #2e7d32;
      color: white;
      padding: 30px 0;
      text-align: center;
      margin-top: 40px;
    }
    
    .footer-content {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .social-icons {
      display: flex;
      gap: 15px;
      margin: 15px 0;
    }
    
    .social-icons a {
      color: white;
      font-size: 20px;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
      }
      
      .hero h2 {
        font-size: 2rem;
      }
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <!-- Header Section -->
  <header>
    <div class="container header-content">
      <div class="logo">
        <i class="fas fa-shopping-basket"></i>
        <h1>Local Mart</h1>
      </div>
      <div class="cart-icon" id="cartIcon">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container hero-content">
      <h2>Fresh Groceries Delivered to Your Doorstep</h2>
      <p>Order from your local store with quick delivery</p>
    </div>
  </section>

  <!-- Products Section -->
  <section class="products-section container">
    <h2 class="section-title">Our Products</h2>
    <div class="products-grid" id="productsGrid">
      <!-- Products will be dynamically added here -->
    </div>
  </section>

  <!-- Cart Section -->
  <section class="container cart-section" id="cartSection">
    <h2 class="section-title">Your Cart</h2>
    <div id="cartItems">
      <!-- Cart items will be dynamically added here -->
    </div>
    <div class="cart-total">
      Total: ₹<span id="cartTotal">0</span>
    </div>
    <button class="checkout-btn" id="checkoutBtn">Proceed to Checkout</button>
  </section>

  <!-- Checkout Form -->
  <section class="container checkout-form" id="checkoutForm">
    <h2 class="section-title">Checkout</h2>
    <form id="orderForm">
      <div class="form-group">
        <label for="name">Full Name</label>
        <input type="text" id="name" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="phone">Phone Number (with country code)</label>
        <input type="tel" id="phone" class="form-control" placeholder="e.g., +919876543210" required>
      </div>
      <div class="form-group">
        <label for="address">Delivery Address</label>
        <textarea id="address" class="form-control" rows="3" required></textarea>
      </div>
      <div class="form-group">
        <label for="payment">Payment Method</label>
        <select id="payment" class="form-control" required>
          <option value="">Select Payment Method</option>
          <option value="cod">Cash on Delivery</option>
          <option value="upi">UPI Payment</option>
          <option value="card">Credit/Debit Card</option>
        </select>
      </div>
      <div class="loading" id="loading">
        <i class="fas fa-spinner fa-spin"></i> Processing your order...
      </div>
      <button type="submit" class="submit-order" id="submitOrder">Place Order</button>
    </form>
  </section>

  <!-- Order Success Section -->
  <section class="container order-success" id="orderSuccess">
    <i class="fas fa-check-circle success-icon"></i>
    <h2>Order Placed Successfully!</h2>
    <p>Thank you for your order. You will receive a WhatsApp confirmation shortly.</p>
    <p>Your order will be delivered within 2 hours.</p>
    <p id="whatsappStatus"></p>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container footer-content">
      <h3>Local Mart</h3>
      <p>Your neighborhood grocery store</p>
      <div class="social-icons">
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-whatsapp"></i></a>
      </div>
      <p>&copy; 2023 Local Mart. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Product data
    const products = [
      {
        id: 1,
        name: "Basmati Rice",
        price: 120,
        image: "https://images.unsplash.com/photo-1586201375761-83865001e31c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        unit: "kg"
      },
      {
        id: 2,
        name: "Fresh Milk",
        price: 30,
        image: "https://images.unsplash.com/photo-1563636619-e9143da7973b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        unit: "L"
      },
      {
        id: 3,
        name: "Toor Dal",
        price: 110,
        image: "https://images.unsplash.com/photo-1592032857148-8d6e8a4c5aef?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        unit: "kg"
      },
      {
        id: 4,
        name: "Wheat Flour",
        price: 40,
        image: "https://images.unsplash.com/photo-1571781926291-47774a3e6c4b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        unit: "kg"
      },
      {
        id: 5,
        name: "Sugar",
        price: 45,
        image: "https://images.unsplash.com/photo-1590502593747-42a996133562?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        unit: "kg"
      }
    ];

    // Cart array to store items
    let cart = [];
    
    // DOM elements
    const productsGrid = document.getElementById('productsGrid');
    const cartIcon = document.getElementById('cartIcon');
    const cartCount = document.getElementById('cartCount');
    const cartSection = document.getElementById('cartSection');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const checkoutForm = document.getElementById('checkoutForm');
    const orderForm = document.getElementById('orderForm');
    const orderSuccess = document.getElementById('orderSuccess');
    const loading = document.getElementById('loading');
    const submitOrderBtn = document.getElementById('submitOrder');
    const whatsappStatus = document.getElementById('whatsappStatus');

    // Initialize the app
    function init() {
      renderProducts();
      loadCartFromStorage();
      updateCartUI();
      
      // Event listeners
      cartIcon.addEventListener('click', toggleCart);
      checkoutBtn.addEventListener('click', showCheckoutForm);
      orderForm.addEventListener('submit', placeOrder);
    }

    // Render products to the page
    function renderProducts() {
      productsGrid.innerHTML = '';
      
      products.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.innerHTML = `
          <div class="product-image">
            <img src="${product.image}" alt="${product.name}">
          </div>
          <div class="product-info">
            <h3 class="product-name">${product.name}</h3>
            <div class="product-price">₹${product.price} / ${product.unit}</div>
            <div class="quantity-controls">
              <button class="qty-btn" onclick="changeQuantity(${product.id}, -1)">-</button>
              <input type="number" class="qty-input" id="qty-${product.id}" value="1" min="1" onchange="updateProductTotal(${product.id})">
              <button class="qty-btn" onclick="changeQuantity(${product.id}, 1)">+</button>
            </div>
            <button class="add-to-cart" onclick="addToCart(${product.id})">Add to Cart</button>
          </div>
        `;
        
        productsGrid.appendChild(productCard);
      });
    }

    // Change quantity of a product
    function changeQuantity(productId, delta) {
      const qtyInput = document.getElementById(`qty-${productId}`);
      let newQty = parseInt(qtyInput.value) + delta;
      
      if (newQty < 1) newQty = 1;
      
      qtyInput.value = newQty;
    }

    // Add product to cart
    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      const qtyInput = document.getElementById(`qty-${productId}`);
      const quantity = parseInt(qtyInput.value);
      
      if (!product || quantity < 1) return;
      
      // Check if product already in cart
      const existingItem = cart.find(item => item.id === productId);
      
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          quantity: quantity,
          unit: product.unit
        });
      }
      
      // Reset quantity input
      qtyInput.value = 1;
      
      saveCartToStorage();
      updateCartUI();
      
      // Show confirmation
      alert(`${quantity} ${product.unit} of ${product.name} added to cart!`);
    }

    // Remove item from cart
    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      saveCartToStorage();
      updateCartUI();
    }

    // Update cart item quantity
    function updateCartItemQuantity(productId, delta) {
      const item = cart.find(item => item.id === productId);
      
      if (item) {
        item.quantity += delta;
        
        if (item.quantity < 1) {
          removeFromCart(productId);
        } else {
          saveCartToStorage();
          updateCartUI();
        }
      }
    }

    // Toggle cart visibility
    function toggleCart() {
      if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
      }
      
      cartSection.style.display = cartSection.style.display === 'block' ? 'none' : 'block';
      checkoutForm.style.display = 'none';
      orderSuccess.style.display = 'none';
    }

    // Show checkout form
    function showCheckoutForm() {
      cartSection.style.display = 'none';
      checkoutForm.style.display = 'block';
    }

    // Place order
    async function placeOrder(e) {
      e.preventDefault();
      
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      const payment = document.getElementById('payment').value;
      
      // Validate form
      if (!name || !phone || !address || !payment) {
        alert('Please fill all fields');
        return;
      }
      
      // Validate phone number format
      if (!phone.startsWith('+')) {
        alert('Please enter phone number with country code (e.g., +91 for India)');
        return;
      }
      
      // Show loading, hide submit button
      loading.style.display = 'block';
      submitOrderBtn.style.display = 'none';
      
      // Create order object
      const order = {
        customer: { name, phone, address, payment },
        items: cart,
        total: calculateTotal(),
        date: new Date().toISOString()
      };
      
      try {
        // Send order to backend
        const response = await fetch('/order', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(order)
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
          // Show success message
          checkoutForm.style.display = 'none';
          orderSuccess.style.display = 'block';
          
          if (result.whatsapp_sent) {
            whatsappStatus.textContent = '✅ WhatsApp notification sent successfully!';
            whatsappStatus.style.color = '#388e3c';
          } else {
            whatsappStatus.textContent = '⚠️ WhatsApp notification could not be sent.';
            whatsappStatus.style.color = '#ff5722';
          }
          
          // Clear cart
          cart = [];
          saveCartToStorage();
          updateCartUI();
        } else {
          alert('There was an error placing your order. Please try again.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('There was an error placing your order. Please try again.');
      } finally {
        // Hide loading, show submit button
        loading.style.display = 'none';
        submitOrderBtn.style.display = 'block';
      }
    }

    // Calculate cart total
    function calculateTotal() {
      return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    }

    // Update cart UI
    function updateCartUI() {
      // Update cart count
      const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
      cartCount.textContent = totalItems;
      
      // Update cart items
      cartItems.innerHTML = '';
      
      if (cart.length === 0) {
        cartItems.innerHTML = '<p>Your cart is empty</p>';
        cartSection.style.display = 'none';
        return;
      }
      
      cart.forEach(item => {
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <div class="cart-item-info">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-price">₹${item.price} / ${item.unit}</div>
          </div>
          <div class="cart-item-quantity">
            <button class="qty-btn" onclick="updateCartItemQuantity(${item.id}, -1)">-</button>
            <span>${item.quantity} ${item.unit}</span>
            <button class="qty-btn" onclick="updateCartItemQuantity(${item.id}, 1)">+</button>
          </div>
          <div class="cart-item-total">₹${item.price * item.quantity}</div>
          <button class="remove-item" onclick="removeFromCart(${item.id})">
            <i class="fas fa-trash"></i>
          </button>
        `;
        
        cartItems.appendChild(cartItem);
      });
      
      // Update total
      cartTotal.textContent = calculateTotal();
    }

    // Save cart to localStorage
    function saveCartToStorage() {
      localStorage.setItem('localMartCart', JSON.stringify(cart));
    }

    // Load cart from localStorage
    function loadCartFromStorage() {
      const savedCart = localStorage.getItem('localMartCart');
      if (savedCart) {
        cart = JSON.parse(savedCart);
      }
    }

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>